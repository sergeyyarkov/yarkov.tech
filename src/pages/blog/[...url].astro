---
import ArticleLayout from "@root/layouts/article.astro";
import { getArticleTranslationsBySlug, incArticleTranslationViews } from "@/src/queries";

// Example of an URL: https://website.com/blog/01-01-2025/my-article/
const { url } = Astro.params as { url: string };
const slug = url.split("/").at(-1);

if (!slug) return Astro.redirect("/404");

const article = await getArticleTranslationsBySlug(slug);

if (!article) return Astro.redirect("/404");

if (import.meta.env.PROD) await incArticleTranslationViews(article);
---

<ArticleLayout lang={article.languages_code?.code.split("-")[0]} article={article} />
