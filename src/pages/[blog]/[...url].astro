---
import ArticleLayout from "@root/layouts/article.astro";
import { fetchArticleTranslationsBySlug, incArticleTranslationViews } from "@/directus";

const { url } = Astro.params as { blog: string; url: string };
const slug = url.split("/").at(-1);

if (!slug) return Astro.redirect("/404");

const article = await fetchArticleTranslationsBySlug(slug);

if (!article) return Astro.redirect("/404");

if (import.meta.env.PROD) await incArticleTranslationViews(article);
---

<ArticleLayout lang={article.languages_code.code} article={article} />
